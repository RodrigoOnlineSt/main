<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <title>Portal de Conteúdos</title>
  <meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no">
  <link href="https://fonts.googleapis.com/css?family=Montserrat:700,400&display=swap" rel="stylesheet">
  <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-storage-compat.js"></script>
  <style>
    html, body {
      margin: 0; padding: 0;
      width: 100vw; min-height: 100vh;
      overflow-x: hidden !important;
      font-family: 'Montserrat', Arial, sans-serif;
      background: linear-gradient(120deg, #1966c4 0%, #654ea3 100%);
      background-attachment: fixed;
    }
    .header {
      background: #fff;
      display: flex;
      justify-content: center;
      align-items: center;
      height: 66px;
      margin-bottom: 18px;
      border-bottom-left-radius: 32px;
      border-bottom-right-radius: 32px;
      box-shadow: 0 8px 32px #14336528;
    }
    .header img {
      max-height: 48px;
      margin-right: 15px;
      border-radius: 11px;
    }
    .header span {
      font-weight: bold;
      font-size: 1.25em;
      color: #1966c4;
    }
    .conteudo {
      max-width: 600px;
      margin: auto;
      padding: 16px 5vw 30px 5vw;
    }
    .card {
      background: #fff;
      border-radius: 16px;
      box-shadow: 0 8px 24px #234 0.08;
      margin-bottom: 25px;
      overflow: hidden;
      padding: 0 0 12px 0;
    }
    .card-capa {
      width: 100%;
      display: block;
      object-fit: cover;
      max-height: 180px;
    }
    .card-titulo {
      font-weight: bold;
      color: #1966c4;
      font-size: 1.21em;
      margin: 18px 16px 7px 16px;
      text-shadow: 0 2px 10px #2d65a02c;
    }
    .galeria {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      margin: 9px 0 0 16px;
    }
    .galeria img, .galeria video {
      width: 64px; height: 64px; object-fit: cover; border-radius: 9px; border: 1.5px solid #2ee1c6a4;
      background: #def9;
    }
    .btn-abrir, .btn-compartilhar {
      display: inline-block;
      margin: 16px 0 0 16px;
      background: #1966c4;
      color: #fff;
      border: none;
      border-radius: 7px;
      padding: 8px 18px;
      font-size: 1em;
      cursor: pointer;
      font-family: 'Montserrat', Arial, sans-serif;
      box-shadow: 0 2px 14px #1966c444;
      transition: background .2s;
    }
    .btn-abrir:hover { background: #2ee1c6; color: #1b2847;}
    .btn-compartilhar { background: #2ee1c6; color: #163246; margin-left: 7px;}
    .card-link {
      font-size: .93em;
      margin: 8px 0 0 16px;
      color: #132;
      word-break: break-all;
      opacity: 0.7;
    }
    /* Fullscreen modal html */
    #modalHtmlFull {
      display: none; position: fixed; z-index: 99;
      left: 0; top: 0; width: 100vw; height: 100vh;
      background: #fff; overflow: auto;
      padding: 0; margin: 0;
      animation: fadeIn .23s;
    }
    @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
    #modalHtmlFull .fechar {
      position: absolute; top: 15px; right: 20px; background: #2ee1c6;
      color: #1b2847; border: none; border-radius: 6px; font-size: 1.4em; font-weight: bold;
      padding: 5px 14px; cursor: pointer; z-index: 100;
      box-shadow: 0 2px 10px #1966c432;
    }
    @media (max-width:650px) {
      .conteudo { padding: 6px 2vw 20px 2vw; }
      .card-titulo { font-size: 1em; }
      .galeria img, .galeria video { width: 46px; height: 46px; }
    }
  </style>
</head>
<body>
  <div class="header">
    <img src="https://i.imgur.com/Tl6sFNO.png" alt="Logo" />
    <span>Portal de Conteúdos</span>
  </div>
  <div class="conteudo" id="conteudo"></div>

  <!-- Modal para HTML fullscreen -->
  <div id="modalHtmlFull">
    <button class="fechar" onclick="fecharHtmlFull()">×</button>
    <div id="htmlFullConteudo" style="padding:0; min-height:100vh;"></div>
  </div>

  <script>
    // --- CONFIG FIREBASE DO SEU PAINEL ADM ---
    const firebaseConfig = {
      apiKey: "SUA_API_KEY_AQUI",
      authDomain: "concursosuper-29c5b.firebaseapp.com",
      projectId: "concursosuper-29c5b",
      storageBucket: "concursosuper-29c5b.appspot.com",
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();

    // Se tiver parâmetro id na URL, mostra só a página individual (compartilhamento)
    const params = new URLSearchParams(location.search);
    const id = params.get("id");

    function escapeHTML(html) {
      let div = document.createElement('div');
      div.textContent = html;
      return div.innerHTML;
    }

    // Função para abrir HTML em tela cheia
    function abrirHtmlCompleto(html) {
      const modal = document.getElementById('modalHtmlFull');
      const conteudo = document.getElementById('htmlFullConteudo');
      conteudo.innerHTML = ""; // Limpa antes
      // Permite scripts e estilos (ATENÇÃO: só use conteúdo de sua confiança!)
      conteudo.innerHTML = html;
      modal.style.display = 'block';
      document.body.style.overflow = "hidden";
      // Responsividade do conteúdo HTML inserido
      const style = document.createElement("style");
      style.innerHTML = `
        #htmlFullConteudo, #htmlFullConteudo * { box-sizing:border-box; max-width:100vw !important; }
        #htmlFullConteudo { padding:0 0 38px 0; }
      `;
      conteudo.appendChild(style);
      window.scrollTo({top:0});
    }
    function fecharHtmlFull() {
      document.getElementById('modalHtmlFull').style.display = 'none';
      document.body.style.overflow = "";
      document.getElementById('htmlFullConteudo').innerHTML = "";
    }

    // Função para montar card de conteúdo
    function cardConteudo(d, docid) {
      let capa = d.capa ? `<img class="card-capa" src="${d.capa}" alt="Capa">` : "";
      let galeria = "";
      if((d.fotos||[]).length || (d.videos||[]).length){
        galeria = `<div class="galeria">`+
          (d.fotos||[]).map(url=>`<img src="${url}">`).join('')+
          (d.videos||[]).map(url=>`<video src="${url}" muted></video>`).join('')+
        `</div>`;
      }
      let btnAbrirHtml = d.html && d.html.trim() ? `<button class="btn-abrir" onclick="abrirHtmlCompleto(\`${d.html.replace(/`/g,"\\`")}\`)">Abrir Página</button>` : "";
      // Link único
      let linkUnico = location.origin + "/?id=" + docid;
      let btnCompartilhar = `<button class="btn-compartilhar" onclick="window.open('https://wa.me/?text='+encodeURIComponent('${d.titulo} - ${linkUnico}'))">Compartilhar</button>`;
      let campoLink = `<div class="card-link">${linkUnico}</div>`;
      return `
        <div class="card">
          ${capa}
          <div class="card-titulo">${escapeHTML(d.titulo||"")}</div>
          ${galeria}
          <div>
            ${btnAbrirHtml} ${btnCompartilhar}
          </div>
          ${campoLink}
        </div>
      `;
    }

    // Carrega o conteúdo: individual ou lista
    async function carregarConteudo() {
      const el = document.getElementById('conteudo');
      el.innerHTML = "<div style='color:#fff;text-align:center;margin:40px 0;'>Carregando...</div>";
      if(id) {
        // Página individual
        const doc = await db.collection("conteudos").doc(id).get();
        if(doc.exists) {
          const d = doc.data();
          el.innerHTML = cardConteudo(d, id);
        } else {
          el.innerHTML = "<div style='color:#fff;text-align:center;margin:44px 0;'>Conteúdo não encontrado.</div>";
        }
      } else {
        // Lista geral
        db.collection("conteudos").orderBy("data","desc").onSnapshot(snapshot=>{
          let html = "";
          snapshot.forEach(doc=>{
            html += cardConteudo(doc.data(), doc.id);
          });
          el.innerHTML = html || "<div style='color:#fff;text-align:center;margin:44px 0;'>Nenhum conteúdo disponível.</div>";
        });
      }
    }
    carregarConteudo();

    // Fecha modal se apertar ESC
    window.addEventListener('keydown', function(e){
      if(e.key==="Escape") fecharHtmlFull();
    });
    // Permite abrir HTML diretamente se página individual já vier com HTML (mobile)
    if(id) setTimeout(()=>{ // Foca abrir HTML se só houver HTML puro
      db.collection("conteudos").doc(id).get().then(doc=>{
        const d = doc.data();
        if(d && d.html && d.html.trim() && !d.capa && (!d.fotos || !d.fotos.length) && (!d.videos || !d.videos.length)){
          abrirHtmlCompleto(d.html);
        }
      });
    }, 800);

  </script>
</body>
</html>
