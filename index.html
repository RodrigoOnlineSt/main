<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <title>Portal de Conteúdos</title>
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <link href="https://fonts.googleapis.com/css?family=Montserrat:700,400&display=swap" rel="stylesheet">
  <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore-compat.js"></script>
  <style>
    body {
      margin: 0;
      background: linear-gradient(120deg, #1966c4 0%, #654ea3 100%);
      min-height: 100vh;
      font-family: 'Montserrat', Arial, sans-serif;
      background-attachment: fixed;
    }
    .header {
      background: #fff;
      display: flex;
      justify-content: center;
      align-items: center;
      height: 66px;
      margin-bottom: 18px;
      border-bottom-left-radius: 32px;
      border-bottom-right-radius: 32px;
      box-shadow: 0 8px 32px #0e214950;
      position: sticky;
      top: 0;
      z-index: 10;
    }
    .header img {
      height: 48px;
      margin-right: 13px;
      border-radius: 14px;
      box-shadow: 0 0 8px #15407844;
    }
    .header span {
      font-size: 1.38em;
      font-weight: bold;
      color: #163a74;
      letter-spacing: 2px;
      text-shadow: 0 3px 18px #1966c466;
    }
    .container {
      max-width: 510px;
      margin: 0 auto;
      padding: 7px 8px 40px 8px;
    }
    .item {
      background: #fff;
      border-radius: 14px;
      margin-bottom: 21px;
      box-shadow: 0 2px 22px #23417a25;
      padding: 12px 12px 10px 12px;
      position: relative;
      overflow: hidden;
      transition: box-shadow .21s;
      border: 2px solid #fff;
    }
    .item:hover { box-shadow: 0 6px 32px #2b5cb644; border:2px solid #3ce1d8;}
    .item-title {
      font-size: 1.22em;
      font-weight: bold;
      color: #1d3573;
      margin-bottom: 6px;
      text-shadow: 0 2px 18px #bde1ff22;
      cursor: pointer;
    }
    .capa {
      width: 98%; max-width: 330px; height: auto; margin: 6px auto 14px auto; display: block; border-radius: 10px; box-shadow: 0 4px 24px #1288ff13;
      cursor: pointer;
      transition: box-shadow .19s;
    }
    .media-list img, .media-list video {
      width: 54px; height: 54px; object-fit: cover;
      border-radius: 7px;
      margin: 2px 6px 2px 0;
      border: 2px solid #1966c433;
      vertical-align: middle;
    }
    .media-list {
      margin-bottom: 9px;
      margin-top: 6px;
    }
    .share-link {
      margin-top: 10px;
      display: flex;
      gap: 9px;
      align-items: center;
      font-size: .97em;
      color: #1771d9;
    }
    .share-link input {
      width: 65%;
      padding: 5px;
      border-radius: 7px;
      border: 1px solid #1966c433;
      font-size: .95em;
      background: #f6faff;
      color: #13396d;
    }
    .share-btn {
      background: #30d5c8;
      color: #1e293b;
      border: none;
      border-radius: 6px;
      padding: 6px 10px;
      font-size: .97em;
      cursor: pointer;
      box-shadow: 0 2px 7px #1966c440;
    }
    .open-html {
      display: inline-block;
      background: #2b4cff;
      color: #fff;
      border-radius: 7px;
      padding: 7px 13px;
      font-weight: bold;
      font-size: 1em;
      margin: 7px 0 0 0;
      box-shadow: 0 3px 12px #3a8eea44;
      border: none;
      cursor: pointer;
    }
    @media (max-width:600px) {
      .container { max-width: 100vw; padding: 3px 2vw 40px 2vw;}
      .item { padding: 9px 4vw 7px 4vw;}
    }
    /* Modal tela cheia para HTML */
    .modal {
      display: none;
      position: fixed;
      top: 0; left: 0; width: 100vw; height: 100vh;
      background: #172236ee;
      z-index: 99;
      justify-content: center;
      align-items: center;
    }
    .modal-content {
      background: #fff;
      border-radius: 18px;
      padding: 0;
      max-width: 98vw;
      max-height: 98vh;
      overflow: auto;
      box-shadow: 0 8px 48px #0009;
      color: #121d38;
      position: relative;
      min-width: 340px;
      min-height: 90vh;
      width: 98vw;
      height: 98vh;
      display: flex;
      flex-direction: column;
    }
    .modal-close {
      position: absolute;
      top: 14px; right: 22px;
      background: none;
      border: none;
      font-size: 2.2em;
      color: #366ad6;
      cursor: pointer;
      font-weight: bold;
      z-index: 2;
    }
    .modal-iframe {
      border: 0;
      width: 100%;
      height: 100%;
      flex: 1;
      background: #fff;
      border-radius: 0 0 18px 18px;
      display: block;
    }
  </style>
</head>
<body>
  <div class="header">
    <img src="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEjNxmA6mH86GQSOc7AKewTETB-55O3iY3QTCytGXS696o25IKkQTU2yQedvgeDo17i_EEYbJoy_eM9t7yN0vpEApNXt19M9Qj8Dh-IIHEi6o3AWTuVZXRtS2rvAT9lY3hAQ4riW3ftOonmBBBTzACHzZJ1pa1EC2joR90I9kH2noEZnCrQTgJOXjVunKjw/s1600/1000123334.png" alt="Logo">
    <span>Portal do Cliente</span>
  </div>
  <div class="container" id="container"></div>

  <!-- Modal para exibir HTML em tela cheia -->
  <div class="modal" id="modalHtml">
    <div class="modal-content" id="modalContent">
      <button class="modal-close" onclick="fecharModal()">&times;</button>
      <iframe id="modalIframe" class="modal-iframe" srcdoc=""></iframe>
    </div>
  </div>

  <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-storage-compat.js"></script>
  <script>
    // Firebase config (mesmo projeto do ADM)
    const firebaseConfig = {
      apiKey: "SUA_API_KEY_AQUI",
      authDomain: "concursosuper-29c5b.firebaseapp.com",
      projectId: "concursosuper-29c5b",
      storageBucket: "concursosuper-29c5b.appspot.com",
      messagingSenderId: "SEU_MESSAGING_SENDER_ID",
      appId: "SEU_APP_ID",
      measurementId: "SEU_MEASUREMENT_ID"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();

    // Pega parâmetro ?id= para abrir post específico (mas nunca abre HTML automático)
    function getParam(name) {
      const url = new URL(window.location);
      return url.searchParams.get(name);
    }

    // Modal abrir/fechar para HTML
    window.abrirModal = function(html) {
      document.getElementById('modalHtml').style.display = 'flex';
      document.getElementById('modalIframe').setAttribute("srcdoc", html);
      document.body.style.overflow = "hidden";
    }
    window.fecharModal = function() {
      document.getElementById('modalHtml').style.display = 'none';
      document.getElementById('modalIframe').setAttribute("srcdoc", "");
      document.body.style.overflow = "";
    }
    window.onclick = function(event) {
      if(event.target === document.getElementById('modalHtml')) fecharModal();
    }

    // Função para criar um card visual bonito e funcional
    function criarItem(doc, dados) {
      let id = doc.id;
      let capa = dados.capa ? `<img class="capa" src="${dados.capa}" onclick="abrirModal(\`${dados.html ? dados.html.replace(/`/g,"\\`").replace(/\\/g,"\\\\") : ''}\`)"${dados.html?' style="cursor:pointer;"':''}>` : "";
      let fotos = (dados.fotos||[]).map(url=>`<img src="${url}">`).join('');
      let videos = (dados.videos||[]).map(url=>`<video src="${url}" muted controls></video>`).join('');
      let midia = (fotos||videos) ? `<div class="media-list">${fotos}${videos}</div>` : "";
      // Link compartilhável
      let shareLink = `${window.location.origin + window.location.pathname}?id=${id}`;
      // Botões de compartilhar/copy
      let shareDiv = `
        <div class="share-link">
          <input value="${shareLink}" onclick="this.select()" readonly>
          <button class="share-btn" onclick="window.open('https://wa.me/?text='+encodeURIComponent('${dados.titulo} - ${shareLink}'))">WhatsApp</button>
          <button class="share-btn" onclick="navigator.clipboard.writeText('${shareLink}');this.textContent='Copiado!';setTimeout(()=>this.textContent='Copiar',1300)">Copiar</button>
        </div>
      `;
      // Botão para abrir HTML se existir
      let btnHtml = dados.html ? `<button class="open-html" onclick="abrirModal(\`${dados.html.replace(/`/g,"\\`").replace(/\\/g,"\\\\")}\`)">Abrir Conteúdo</button>` : "";
      // Título vira botão se tiver HTML
      let titulo = dados.html
        ? `<div class="item-title" onclick="abrirModal(\`${dados.html.replace(/`/g,"\\`").replace(/\\/g,"\\\\")}\`)">${dados.titulo||""}</div>`
        : `<div class="item-title">${dados.titulo||""}</div>`;
      // Monta o card completo
      return `
        <div class="item">
          ${titulo}
          ${capa}
          ${midia}
          ${btnHtml}
          ${shareDiv}
        </div>
      `;
    }

    // Carregar um post específico (mas nunca abrir HTML de cara)
    async function carregarPorId(id) {
      let container = document.getElementById('container');
      let doc = await db.collection("conteudos").doc(id).get();
      if(!doc.exists) { container.innerHTML = "<div style='color:#fff;font-size:1.3em;text-align:center;margin-top:40px;'>Conteúdo não encontrado!</div>"; return; }
      let d = doc.data();
      container.innerHTML = criarItem(doc, d);
      // NÃO abre HTML automático!
    }

    // Carregar lista de conteúdos se não tiver id específico
    function carregarTodos() {
      db.collection("conteudos").orderBy("data","desc").onSnapshot(snapshot=>{
        let container = document.getElementById('container');
        let html = "";
        snapshot.forEach(doc=>{
          html += criarItem(doc, doc.data());
        });
        container.innerHTML = html || "<div style='color:#fff;font-size:1.12em;text-align:center;margin-top:40px;'>Nenhuma publicação ainda.</div>";
      });
    }

    // Detecta se deve exibir um post único ou todos
    let id = getParam("id");
    if(id) carregarPorId(id);
    else carregarTodos();
  </script>
</body>
</html>
