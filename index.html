<!--
Requer que a instância db do Firebase Firestore já esteja inicializada!
Use:
<script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore-compat.js"></script>
-->
<script>
// Função para injetar HTML e rodar scripts, com CSS global responsivo
function setHtmlWithScripts(container, html) {
  container.innerHTML = html;

  // Adiciona CSS global responsivo (evita múltiplos)
  if (!document.getElementById('css-conteudo-html-full')) {
    const cssGlobal = `
      html, body { max-width: 100vw !important; overflow-x: hidden !important; }
      #conteudo-html-full-outer, #conteudo-html-full-inner { max-width: 100vw !important; }
      #conteudo-html-full-inner, #conteudo-html-full-inner * {
        box-sizing: border-box !important;
        max-width: 100vw !important;
        overflow-x: auto !important;
        margin-left: auto !important; margin-right: auto !important;
      }
      #conteudo-html-full-inner table,
      #conteudo-html-full-inner .grid,
      #conteudo-html-full-inner img,
      #conteudo-html-full-inner > div,
      #conteudo-html-full-inner > * {
        max-width: 100vw !important; width: 100% !important; display: block !important;
        margin-left: auto !important; margin-right: auto !important;
      }
      #conteudo-html-full-inner img { height: auto !important; }
      #conteudo-html-full-inner td, #conteudo-html-full-inner th {
        word-break: break-word !important;
        white-space: pre-line !important;
      }
    `;
    let styleTag = document.createElement('style');
    styleTag.id = 'css-conteudo-html-full';
    styleTag.innerHTML = cssGlobal;
    document.head.appendChild(styleTag);
  }

  // Reinjetar scripts inline/dinâmicos
  const scripts = container.querySelectorAll('script');
  scripts.forEach(oldScript => {
    const newScript = document.createElement('script');
    if (oldScript.src) newScript.src = oldScript.src;
    if (oldScript.type) newScript.type = oldScript.type;
    newScript.innerHTML = oldScript.innerHTML;
    oldScript.parentNode.replaceChild(newScript, oldScript);
  });
}

// Função para mostrar o conteúdo em tela cheia
function mostrarConteudoTelaInteira(id) {
  // Limpa todo o conteúdo do <body> (página fica só com o HTML publicado)
  document.body.innerHTML = "";

  // Cria wrappers para centralização e responsividade
  let outer = document.createElement("div");
  outer.id = "conteudo-html-full-outer";
  let inner = document.createElement("div");
  inner.id = "conteudo-html-full-inner";
  outer.appendChild(inner);
  document.body.appendChild(outer);

  // Busca o conteúdo no Firestore
  db.collection("conteudos").doc(id).get().then(doc => {
    if (!doc.exists) {
      inner.innerHTML = "<div style='color:red;text-align:center;margin:40px 0'>Conteúdo não encontrado</div>";
      return;
    }
    let htmlPublicado = doc.data().html || "";
    if (htmlPublicado.trim().length > 0) {
      setHtmlWithScripts(inner, htmlPublicado);
      document.body.style.overflowX = "hidden";
      document.documentElement.style.overflowX = "hidden";
    } else {
      inner.innerHTML = "<div style='color:red;text-align:center;margin:40px 0'>Nenhum conteúdo HTML publicado.</div>";
    }
  });
}
</script>
