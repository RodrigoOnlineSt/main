<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <title>Publicações</title>
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <link href="https://fonts.googleapis.com/css?family=Montserrat:700,400&display=swap" rel="stylesheet">
  <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-storage-compat.js"></script>
  <style>
    body { background: #f6f8fa; font-family:'Montserrat',Arial,sans-serif; margin:0; }
    .header { background: #1966c4; color: #fff; text-align: center; padding: 18px 0; margin-bottom: 18px; }
    .container { max-width: 560px; margin: auto; padding: 16px 10px; }
    .item { background: #fff; border-radius: 10px; margin-bottom: 22px; box-shadow: 0 3px 18px #2341; padding: 15px 14px; }
    .titulo { font-size: 1.16em; font-weight: bold; color: #1966c4; margin-bottom: 8px; }
    .capa { width: 100%; max-height: 180px; border-radius: 7px; object-fit: cover; display: block; margin-bottom: 8px; }
    .galeria { display: flex; flex-wrap: wrap; gap: 8px; margin-bottom: 6px;}
    .galeria img, .galeria video { width: 56px; height: 56px; object-fit: cover; border-radius: 5px; border: 1px solid #ddd; background:#eee; }
    .botoes { margin-top: 8px;}
    .btn { display: inline-block; background: #1966c4; color: #fff; border: none; border-radius: 6px; padding: 7px 16px; font-size: 1em; cursor: pointer; margin-right: 8px;}
    .btn-compartilhar { background: #30d5c8; color: #163246; }
    .link { font-size: .93em; color:#123; opacity: 0.8; word-break: break-all; margin-top:5px;}
    /* Modal HTML fullscreen */
    #modalHtmlFull { display:none; position:fixed;z-index:99;left:0;top:0;width:100vw;height:100vh;background:#fff;overflow:auto;padding:0;margin:0;}
    #modalHtmlFull .fechar { position:absolute;top:15px;right:20px;background:#1966c4;color:#fff;border:none;border-radius:6px;font-size:1.4em;padding:5px 14px;cursor:pointer;}
    #htmlFullConteudo { padding: 0; min-height: 100vh; }
    @media (max-width:600px){
      .container { padding: 7px 2vw; }
      .item { padding: 11px 5px; }
      .titulo { font-size: 1em; }
      .galeria img, .galeria video { width: 44px; height: 44px; }
    }
  </style>
</head>
<body>
  <div class="header">
    <span>Publicações</span>
  </div>
  <div class="container" id="container"></div>
  <!-- Modal para HTML fullscreen -->
  <div id="modalHtmlFull">
    <button class="fechar" onclick="fecharHtmlFull()">×</button>
    <div id="htmlFullConteudo"></div>
  </div>
  <script>
    // --- CONFIG FIREBASE DO SEU PAINEL ADM ---
    const firebaseConfig = {
      apiKey: "SUA_API_KEY_AQUI",
      authDomain: "concursosuper-29c5b.firebaseapp.com",
      projectId: "concursosuper-29c5b",
      storageBucket: "concursosuper-29c5b.appspot.com",
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();

    // Se tiver parâmetro id na URL, mostra só a página individual
    const params = new URLSearchParams(location.search);
    const id = params.get("id");

    // Abrir HTML em tela cheia
    function abrirHtmlCompleto(html) {
      const modal = document.getElementById('modalHtmlFull');
      const conteudo = document.getElementById('htmlFullConteudo');
      conteudo.innerHTML = html;
      modal.style.display = 'block';
      document.body.style.overflow = "hidden";
    }
    function fecharHtmlFull() {
      document.getElementById('modalHtmlFull').style.display = 'none';
      document.body.style.overflow = "";
      document.getElementById('htmlFullConteudo').innerHTML = "";
    }

    // Card de conteúdo
    function cardConteudo(d, docid) {
      let capa = d.capa ? `<img class="capa" src="${d.capa}" alt="Capa">` : "";
      let galeria = "";
      if((d.fotos||[]).length || (d.videos||[]).length){
        galeria = `<div class="galeria">`+
          (d.fotos||[]).map(url=>`<img src="${url}">`).join('')+
          (d.videos||[]).map(url=>`<video src="${url}" muted></video>`).join('')+
        `</div>`;
      }
      let btnAbrirHtml = d.html && d.html.trim() ? `<button class="btn" onclick="abrirHtmlCompleto(\`${d.html.replace(/`/g,"\\`")}\`)">Abrir Página</button>` : "";
      // Link único
      let linkUnico = location.origin + "/?id=" + docid;
      let btnCompartilhar = `<button class="btn btn-compartilhar" onclick="window.open('https://wa.me/?text='+encodeURIComponent('${d.titulo} - ${linkUnico}'))">Compartilhar</button>`;
      let campoLink = `<div class="link">${linkUnico}</div>`;
      return `
        <div class="item">
          ${capa}
          <div class="titulo">${d.titulo||""}</div>
          ${galeria}
          <div class="botoes">
            ${btnAbrirHtml} ${btnCompartilhar}
          </div>
          ${campoLink}
        </div>
      `;
    }

    // Carrega o conteúdo: individual ou lista
    async function carregarConteudo() {
      const el = document.getElementById('container');
      el.innerHTML = "<div style='color:#222;text-align:center;margin:40px 0;'>Carregando...</div>";
      if(id) {
        // Página individual
        const doc = await db.collection("conteudos").doc(id).get();
        if(doc.exists) {
          const d = doc.data();
          el.innerHTML = cardConteudo(d, id);
        } else {
          el.innerHTML = "<div style='color:#222;text-align:center;margin:44px 0;'>Conteúdo não encontrado.</div>";
        }
      } else {
        // Lista geral
        db.collection("conteudos").orderBy("data","desc").onSnapshot(snapshot=>{
          let html = "";
          snapshot.forEach(doc=>{
            html += cardConteudo(doc.data(), doc.id);
          });
          el.innerHTML = html || "<div style='color:#222;text-align:center;margin:44px 0;'>Nenhum conteúdo disponível.</div>";
        });
      }
    }
    carregarConteudo();

    // Fecha modal se apertar ESC
    window.addEventListener('keydown', function(e){
      if(e.key==="Escape") fecharHtmlFull();
    });
  </script>
</body>
</html>
