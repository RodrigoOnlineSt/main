<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <title>Portal do Cliente - Cassino</title>
  <meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no">
  <link href="https://fonts.googleapis.com/css?family=Montserrat:700,400&display=swap" rel="stylesheet">
  <style>
    body {
      margin:0; font-family:'Montserrat',sans-serif;
      background: linear-gradient(120deg, #0d1b2a 0%, #122d42 80%, #4a148c 100%);
      color:#f6f6f6; min-height:100vh;
    }
    .topbar {
      background: rgba(20,24,44,0.96);
      box-shadow: 0 3px 22px #16044f80;
      padding:10px 0 8px 0;
      display:flex;align-items:center;justify-content:center;
      border-bottom:2px solid #3f0e84;
      margin-bottom:22px;
      position:sticky;top:0;z-index:20;
    }
    .topbar img { height:44px; filter:drop-shadow(0 2px 7px #9a66ff88);}
    .content { max-width:420px; margin:0 auto; padding:2px 0 44px 0;}
    .post-card {
      background: rgba(26,30,54,0.87);
      border-radius:17px;
      box-shadow: 0 6px 34px #4611b455, 0 1.5px 0 #3f0e8459;
      margin-bottom: 24px;
      padding:15px 12px 13px 12px;
      position:relative;
      overflow:hidden;
      border:1.7px solid #31146566;
      backdrop-filter:blur(3.5px);
      transition:.2s;
    }
    .post-card:hover { box-shadow:0 8px 36px #7f36d855, 0 2px 8px #7b42f9;}
    .post-titulo {
      font-size:1.13em;
      color:#e0afff;
      font-weight:700;
      margin-bottom:8px;
      letter-spacing:0.02em;
      text-shadow:0 2px 7px #36007930, 0 1px 0 #fff3;
    }
    .post-data {font-size:.95em;color:#bbadf7;position:absolute;top:12px;right:15px;}
    .post-media img, .post-media video {
      width:97%;border-radius:10px;margin:11px auto 10px auto;display:block;box-shadow:0 2px 19px #7c4bff55;
      background:#1a144b;
    }
    .post-media audio { width:97%; margin:9px 0;}
    .post-media iframe {width:97%;min-height:165px;border-radius:10px;margin:11px 0;background:#100a32;}
    .post-html-btn {
      background:linear-gradient(90deg,#7e51ff,#19e2ea 90%);
      color:#2a0037; border:none; border-radius:9px; padding:9px 21px; font-size:1em; font-weight:700;
      margin:13px 0 2px 0; cursor:pointer; box-shadow:0 3px 18px #2b028f35; letter-spacing:.01em;
      transition:.13s;
    }
    .post-html-btn:hover { background:linear-gradient(92deg,#1f76ff,#7e51ff 85%); color:#fff;}
    .share-btn {
      background:#25D366;color:#fff;border:none;border-radius:7px;padding:8px 22px;font-size:1em;cursor:pointer;font-weight:700;
      box-shadow:0 1.5px 7px #25d36650;letter-spacing:.02em;transition:.16s;
      margin-top:7px;
    }
    .share-btn:active { background:#1aa958;}
    /* Slide/Carrossel */
    .slide-wrapper { width:100%; position:relative; margin-bottom:15px; }
    .slide-img { width:100%; max-height:210px; border-radius:13px; box-shadow:0 2px 19px #7c4bff55; object-fit:cover; background:#111; }
    .slide-arrows { position:absolute; top:45%; left:0; width:100%; display:flex; justify-content:space-between; pointer-events:none;}
    .slide-arrow {
      background:rgba(20,14,50,.84); color:#fff; border:none; border-radius:50%; width:38px; height:38px; font-size:1.6em; cursor:pointer; box-shadow:0 2px 9px #0007;
      display:flex;align-items:center;justify-content:center; pointer-events:auto;
      transition:.14s;
    }
    .slide-arrow:active { background:#350b4a;}
    .slide-dots { text-align:center; margin-top:4px; }
    .slide-dot {
      display:inline-block; width:9px; height:9px; margin:0 2px; border-radius:50%; background:#bfa3ee; opacity:.5; transition:.13s; cursor:pointer;
    }
    .slide-dot.active { background:#fff; opacity:1;}
    /* Botão de voltar */
    .back-btn {
      position:fixed;top:17px;left:11px;z-index:99;background:rgba(30,10,40,0.89);color:#fff;border:none;border-radius:50%;width:44px;height:44px;font-size:2em;cursor:pointer;
      box-shadow:0 2px 7px #13024c60;transition:.15s;display:flex;align-items:center;justify-content:center;
    }
    .back-btn:active{background:#4a148c;}
    @media (max-width:600px) {
      .content { max-width:98vw;}
      .topbar img { max-width:87vw;}
      .post-card { padding:11px 4vw 11px 4vw;}
    }
  </style>
  <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore-compat.js"></script>
</head>
<body>
  <div class="topbar">
    <img src="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEjNxmA6mH86GQSOc7AKewTETB-55O3iY3QTCytGXS696o25IKkQTU2yQedvgeDo17i_EEYbJoy_eM9t7yN0vpEApNXt19M9Qj8Dh-IIHEi6o3AWTuVZXRtS2rvAT9lY3hAQ4riW3ftOonmBBBTzACHzZJ1pa1EC2joR90I9kH2noEZnCrQTgJOXjVunKjw/s1600/1000123334.png" alt="Logo">
  </div>
  <button class="back-btn" id="backBtn" style="display:none;" onclick="location.href=location.pathname" title="Voltar">&times;</button>
  <div class="content" id="posts"></div>
  <script>
    // Firebase config
    const firebaseConfig = {
      apiKey: "SUA_API_KEY_AQUI",
      authDomain: "concursosuper-29c5b.firebaseapp.com",
      projectId: "concursosuper-29c5b",
      storageBucket: "concursosuper-29c5b.appspot.com",
      messagingSenderId: "SEU_MESSAGING_SENDER_ID",
      appId: "SEU_APP_ID",
      measurementId: "SEU_MEASUREMENT_ID"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();

    function getQueryParam(k){
      let p = new URLSearchParams(window.location.search);
      return p.get(k);
    }

    function youtubeID(url){
      let m = url.match(/(?:youtu\.be\/|youtube\.com\/(?:watch\?v=|embed\/))([\w-]{11})/);
      return m ? m[1] : '';
    }

    // --- SLIDE DINÂMICO SEGURO ---
    function renderSlide(fotos, id) {
      if(!fotos||!fotos.length) return '';
      let slideId = 'slide_'+id;
      let imgs = fotos.map((f,i)=>`<img class="slide-img" src="${f}" style="display:${i==0?'block':'none'};">`).join('');
      let dots = fotos.map((f,i)=>`<span class="slide-dot${i==0?' active':''}" data-idx="${i}" data-slide="${slideId}"></span>`).join('');
      return `
        <div class="slide-wrapper" id="${slideId}">
          ${imgs}
          <div class="slide-arrows">
            <button class="slide-arrow" data-slide="${slideId}" data-dir="prev">&#8678;</button>
            <button class="slide-arrow" data-slide="${slideId}" data-dir="next">&#8680;</button>
          </div>
          <div class="slide-dots">${dots}</div>
        </div>
      `;
    }

    function activateAllSlides() {
      document.querySelectorAll('.slide-wrapper').forEach(function(slideWrap){
        let imgs = slideWrap.querySelectorAll('.slide-img');
        let dots = slideWrap.querySelectorAll('.slide-dot');
        let idx = 0;
        function show(i){
          imgs.forEach((img,j)=>img.style.display=(j===i?'block':'none'));
          dots.forEach((dot,j)=>dot.classList.toggle('active',j===i));
          idx=i;
        }
        // Arrows
        slideWrap.querySelectorAll('.slide-arrow').forEach(btn=>{
          btn.onclick = function(e){
            e.stopPropagation();
            if(btn.dataset.dir==='prev') show((idx-1+imgs.length)%imgs.length);
            else show((idx+1)%imgs.length);
          }
        });
        // Dots
        dots.forEach(dot=>{
          dot.onclick = function(e){
            e.stopPropagation();
            show(Number(dot.dataset.idx));
          }
        });
      });
    }

    function renderPostFull(d, id) {
      return `
      <div class="post-card" style="margin-top:16px;">
        ${renderSlide(d.slide||[], id)}
        <div class="post-titulo">${d.titulo || ''}</div>
        <div class="post-data">${d.data && d.data.seconds ? new Date(d.data.seconds*1000).toLocaleString() : ''}</div>
        <div class="post-media">
          ${d.texto ? `<div style="margin-bottom:8px;color:#e2d6ff;">${d.texto}</div>` : ''}
          ${(d.fotos||[]).map(f=>`<img src="${f}" alt="">`).join('')}
          ${(d.videos||[]).map(v=>v.includes('youtu')?`<iframe src="https://www.youtube.com/embed/${youtubeID(v)}" frameborder="0" allowfullscreen></iframe>`:`<video src="${v}" controls></video>`).join('')}
          ${(d.audios||[]).map(a=>`<audio src="${a}" controls></audio>`).join('')}
        </div>
        ${d.html ? `<button class="post-html-btn" onclick="abrirHtml('${btoa(unescape(encodeURIComponent(d.html)))}')">Abrir HTML especial</button>` : ''}
        <button class="share-btn" onclick="share('${id}')">Compartilhar</button>
      </div>`;
    }

    function renderPostList(d, id){
      return `
      <div class="post-card">
        ${renderSlide(d.slide||[], id)}
        <div class="post-titulo">${d.titulo || ''}</div>
        <div class="post-data">${d.data && d.data.seconds ? new Date(d.data.seconds*1000).toLocaleString() : ''}</div>
        <div class="post-media">
          ${d.texto ? `<div style="margin-bottom:8px;color:#e2d6ff;">${d.texto}</div>` : ''}
          ${(d.fotos||[]).map(f=>`<img src="${f}" alt="">`).join('')}
          ${(d.videos||[]).map(v=>v.includes('youtu')?`<iframe src="https://www.youtube.com/embed/${youtubeID(v)}" frameborder="0" allowfullscreen></iframe>`:`<video src="${v}" controls></video>`).join('')}
          ${(d.audios||[]).map(a=>`<audio src="${a}" controls></audio>`).join('')}
        </div>
        ${d.html ? `<button class="post-html-btn" onclick="abrirHtml('${btoa(unescape(encodeURIComponent(d.html)))}')">Abrir HTML especial</button>` : ''}
        <button class="share-btn" onclick="share('${id}')">Compartilhar</button>
        <button onclick="abrirPagina('${id}')" class="share-btn" style="background:#6937ff;margin-left:7px;">Abrir Página</button>
      </div>`;
    }

    function share(id){
      const url = `${location.origin}${location.pathname}?id=${id}`;
      if(navigator.share){
        navigator.share({title:'Veja isso!', url});
      } else {
        prompt('Link:', url);
      }
    }

    function abrirHtml(base64){
      let html = decodeURIComponent(escape(atob(base64)));
      let w = window.open();
      w.document.write(`
        <html><head><meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=no">
        <title>Visualização HTML</title>
        <style>
          body{margin:0;padding:8px 2vw;font-family:Arial,sans-serif;background:#16142e;color:#f6f6f6;max-width:100vw;}
          img,video,iframe{max-width:100%!important;height:auto!important;display:block;margin:0 auto 14px auto;border-radius:8px;}
        </style>
        </head><body>${html}</body></html>
      `);
    }

    function abrirPagina(id){
      location.href = `${location.pathname}?id=${id}`;
    }

    function carregar(){
      const id = getQueryParam('id');
      const postsDiv = document.getElementById('posts');
      const backBtn = document.getElementById('backBtn');
      if(id){
        backBtn.style.display = '';
        db.collection("conteudos").doc(id).get().then(doc=>{
          if(doc.exists){
            postsDiv.innerHTML = renderPostFull(doc.data(), id);
            setTimeout(activateAllSlides,50);
          }else{
            postsDiv.innerHTML = `<div style="color:#fff;text-align:center;padding:32px 0;">Publicação não encontrada.</div>`;
          }
        });
      }else{
        backBtn.style.display = 'none';
        db.collection("conteudos").orderBy("data","desc").onSnapshot(ss=>{
          postsDiv.innerHTML = ss.docs.map(doc=>renderPostList(doc.data(), doc.id)).join('') || '<p style="color:#ccc;">Nenhum post ainda.</p>';
          setTimeout(activateAllSlides,50);
        });
      }
    }
    carregar();
    window.onpopstate = carregar;
  </script>
</body>
</html>
